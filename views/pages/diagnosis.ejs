<div class="container">
  <h1 class="text-center">Diagnosis</h1>
  <form id="diagnosisForm" method="POST" action="/dg">
    <div class="form-group">
      <label for="diagnosis">Diagnosis</label>
      <input type="text" class="form-control" id="diagnosis" name="diagnosis"
        required>
      <div class="invalid-feedback">Please provide a diagnosis.</div>
    </div>

    <div class="form-group">
      <label>Type</label>
      <div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="type"
            id="infection" value="Infection" required>
          <label class="form-check-label" for="infection">Infection</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="type" id="virus"
            value="Virus" required>
          <label class="form-check-label" for="virus">Virus</label>
        </div>
        <div class="invalid-feedback d-block">Please select an option.</div>
      </div>
    </div>

    <div class="form-group">
      <label for="overview">Overview</label>
      <textarea class="form-control" id="overview" name="overview" rows="3"
        required></textarea>
      <div class="invalid-feedback">Please provide an overview.</div>
    </div>

    <div class="form-group">
      <label for="symptoms">Symptoms</label>
      <input type="text" class="form-control" id="symptoms" name="symptoms"
        required>
      <div class="invalid-feedback">Please provide symptoms.</div>
    </div>

    <div class="form-group">
      <label for="treatments">Treatments</label>
      <input type="text" class="form-control" id="treatments" name="treatments"
        required>
      <div class="invalid-feedback">Please provide treatments.</div>
    </div>

    <div class="form-group">
      <label for="specialists">Specialists</label>
      <input type="text" class="form-control" id="specialists"
        name="specialists" required>
      <div class="invalid-feedback">Please provide specialists.</div>
    </div>

    <div class="form-group">
      <label for="contagiousMethod">Contagious Method</label>
      <input type="text" class="form-control" id="contagiousMethod"
        name="contagiousMethod" required>
      <div class="invalid-feedback">Please provide a contagious method.</div>
    </div>

    <button type="submit" class="btn mt-4 btn-primary">Submit</button>
  </form>
</div>

<script>
 document.getElementById('diagnosisForm').addEventListener('submit', async (event) => {
  event.preventDefault();
  const form = event.target;
  const formData = new FormData(form);
  const diagnosisData = {};
  formData.forEach((value, key) => {
    diagnosisData[key] = value;
  });

  const query = `
    mutation CreateDiagnosis($diagnosis: String!, $type: String!, $overview: String!, $symptoms: String!, $treatments: String!, $specialists: String!, $contagiousMethod: String!) {
      createDiagnosis(diagnosis: $diagnosis, type: $type, overview: $overview, symptoms: $symptoms, treatments: $treatments, specialists: $specialists, contagiousMethod: $contagiousMethod) {
        id
      }
    }
  `;

  try {
    const response = await fetch('/graphql', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, variables: diagnosisData })
    });

    const result = await response.json();
    //console.log(result); // Log the response to debug

    if (result.error) {
      //console.error(result.errors); // Log the errors
      console.log('Error submitting form');
    } else {
      console.log('Form submitted successfully');
      window.location.href = '/success';
    }
  } catch (error) {
    console.error('Error submitting form:', error);
    alert('Error submitting form');
  }
});

</script>